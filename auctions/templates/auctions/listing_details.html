{% extends "auctions/layout.html" %}
{% load static %}

{% block body %}

<div class="container-fluid">
    <div class="row justify-content-md-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="row no-gutters">
                    <!-- Columna izquierda: Imagen -->
                    <div class="col-md-6">
                        {% if item.image %}
                            <img class="card-img" src="{{ item.image.url }}" alt="Item Image" style="height: 100%; width: 100%; object-fit: cover;">
                        {% else %}
                            <p class="text-center">No image available</p>
                        {% endif %}
                    </div>

                    <!-- Columna derecha: Información -->
                    <div class="col-md-6">
                        <div class="card-body">
                           
                            <div style="margin-right: 20px;">
                                <label class="font-weight-bold" style="color: black;">Lote:</label>
                                <span class="card-title font-weight-bold" title="{{ item.0.title }}" style="color: black;">
                                    {{ item.title }}
                                </span>
                            </div>
                        
                            <div>
                                <label class="font-weight-bold" style="color: black;">Nombre:</label>
                                <span class="card-text text-truncate" title="{{ item.0.description }}" style="color: black;">
                                    {{ item.description }}
                                </span>
                            </div>

                            <!-- Información de la oferta -->
                            <div class="d-flex align-items-center mb-3">
                                <label class="font-weight-bold mr-2" style="color: black;">Oferta:</label>
                                <span class="h3" 
                                      style="color: {% if last_bid %} rgb(228, 30, 30) {% else %} black {% endif %};">
                                    {% if last_bid %}
                                        ${{ last_bid.amount }}
                                    {% else %}
                                        ${{ item.starting_bid }}
                                    {% endif %}
                                </span>
                            </div>

                            <!-- Botones de oferta adicionales -->
                            <div class="mt-3">
                                <button type="button" class="btn btn-secondary mr-2" onclick="updateBidAmount(1000)">+1000</button>
                                <button type="button" class="btn btn-secondary" onclick="updateBidAmount(5000)">+5000</button>
                            </div>

                            <script>
                                function updateBidAmount(amount) {
                                    var bidInput = document.getElementById('bidAmount');
                                    var currentBid = parseFloat(bidInput.value) || 0;
                                    var newBid = currentBid + amount;
                                    bidInput.value = newBid;
                                    // Automatically submit the form with the new bid amount
                                    document.getElementById('bidForm').submit();
                                }
                            </script>

                            <!-- Formulario de oferta -->
                            <form method="POST" action="{% url 'auctions:place_bid' %}" id="bidForm" class="mt-3">
                                {% csrf_token %}
                                <input type="hidden" id="bidAmount" name="new_bid" value="{% if last_bid %}{{ last_bid.amount }}{% else %}{{ item.starting_bid }}{% endif %}">
                                <input type="hidden" name="listing_title" value="{{ item.title }}">
                                <input type="hidden" name="item_id" value="{{ item.id }}"> <!-- Añadir ID del ítem -->
                            </form>

                            <!-- Botón para cerrar la subasta (si aplica) -->
                            {% if privilege %}
                            <form action="{% url 'auctions:end_listing' %}" method="POST" class="mt-3">
                                {% csrf_token %}
                                <input type="hidden" name="item_id" value="{{ item.id }}">
                                <button type="submit" class="btn btn-warning">Cerrar Subasta</button>
                            </form>
                            {% endif %}

                            <!-- Sección de ofertas recientes -->
                            <div class="mt-4">
                                <h6 class="font-weight-bold">Ofertas recientes:</h6>
                                <ul class="list-group list-group-flush">
                                    {% for bid in recent_bids %}
                                        <li class="list-group-item d-flex justify-content-between">
                                            <span>{{ bid.user.username|slice:":3" }}***</span>
                                            <span class="font-weight-bold">${{ bid.amount }}</span>
                                        </li>
                                    {% empty %}
                                        <li class="list-group-item text-center">No hay ofertas aún.</li>
                                    {% endfor %}
                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}
